# 纯真IP库查询API服务 - 常见问题解答

## 基本问题

### Q: 什么是纯真IP库？
A: 纯真IP库是一个免费的IP地址数据库，提供IP地址与地理位置的对应关系，主要针对中国大陆的IP地址有较高的精确度。

### Q: 这个API服务的主要功能是什么？
A: 本服务提供基于纯真IP库的高性能IP地址查询API，支持单个IP查询、批量查询、当前IP查询等功能，并提供REST风格的接口。

### Q: 服务支持哪些查询方式？
A: 支持单个IP查询、批量IP查询（最多100个）、当前访客IP查询。

## 安装与部署

### Q: 如何快速部署这个服务？
A: 您可以通过以下几种方式部署：
1. 直接在Node.js环境中运行
2. 使用PM2进行集群部署
3. 使用Docker容器化部署

### Q: 服务的最低系统要求是什么？
A: 
- Node.js >= 14.0.0
- npm >= 6.0.0
- 内存 >= 512MB
- 磁盘空间 >= 100MB

### Q: 如何更新IP数据库？
A: 运行 `npm run update-db` 命令可以手动更新IP库。系统也会根据配置自动定期更新。

## 使用问题

### Q: 如何查询单个IP地址？
A: 发送GET请求到 `/ip/{ip}` 接口，例如：`GET /ip/8.8.8.8`

### Q: 如何批量查询多个IP地址？
A: 发送POST请求到 `/batch` 接口，请求体为JSON格式，包含IP数组，例如：
```json
{
  "ips": ["8.8.8.8", "114.114.114.114", "223.5.5.5"]
}
```

### Q: 如何查询访问者自己的IP地址？
A: 发送GET请求到 `/myip` 接口。

### Q: 返回的数据格式是什么？
A: 所有API返回JSON格式数据，包含查询结果、地理位置信息等。

## 性能与优化

### Q: 服务的并发处理能力如何？
A: 在标准配置下，服务可以处理1000+ QPS的查询请求。使用PM2集群模式可以进一步提高并发处理能力。

### Q: 如何提高查询性能？
A: 
1. 启用PM2集群模式
2. 增加服务器内存，提高缓存容量
3. 使用Nginx等反向代理进行负载均衡
4. 调整缓存策略，延长缓存时间

### Q: 缓存机制是如何工作的？
A: 系统使用内存缓存，默认缓存查询结果1小时。这大大减少了重复查询的数据库访问，提高了响应速度。

## 故障排除

### Q: 服务启动失败怎么办？
A: 
1. 检查端口是否被占用
2. 确认Node.js版本是否符合要求
3. 检查日志文件中的错误信息
4. 确保有足够的系统权限

### Q: IP查询结果不准确怎么办？
A: 运行 `npm run update-db` 更新IP库到最新版本。纯真IP库定期更新，保持最新版本可以提高准确性。

### Q: 内存使用过高怎么处理？
A: 
1. 调整缓存配置，减少缓存时间或缓存条目数量
2. 使用PM2的内存限制功能
3. 定期重启服务释放内存

### Q: 如何查看服务运行状态？
A: 
1. 访问 `/health` 接口查看健康状态
2. 访问 `/stats` 接口查看详细统计信息
3. 使用 `pm2 status` 命令查看进程状态
4. 使用 `pm2 monit` 命令实时监控服务

## 高级配置

### Q: 如何配置多实例集群？
A: 编辑 `ecosystem.config.js` 文件，修改 `instances` 参数。设置为 `max` 将使用所有可用CPU核心。

### Q: 如何修改服务端口？
A: 可以通过环境变量 `PORT` 设置，或修改 `ecosystem.config.js` 中的配置。

### Q: 如何设置自动更新IP库？
A: PM2配置中已包含定时任务，默认每天凌晨2点自动更新IP库。可以修改 `ecosystem.config.js` 中的 `cron_restart` 参数调整时间。

### Q: 如何配置日志轮转？
A: PM2默认提供日志管理功能，可以使用 `pm2 install pm2-logrotate` 安装日志轮转插件，并进行相应配置。

## 其他问题

### Q: 如何贡献代码？
A: 请参考项目README中的贡献指南，通过Fork和Pull Request的方式提交代码。

### Q: 这个项目的许可证是什么？
A: 本项目采用MIT许可证，详情请查看项目根目录下的LICENSE文件。

### Q: 在哪里可以获取更多帮助？
A: 可以通过GitHub Issues提交问题，或者查阅项目文档获取更多信息。